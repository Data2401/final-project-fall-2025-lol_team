---
title: "LOL_Dataset_Project"
author: "Tamana Yaqoubi, Veronica Alviso"
date: "2025-11-04"
output: 
  html_document:
    self_contained: false      
    highlight: null
    pandoc_args: ["--syntax-highlighting=none"]
---

## About the dataset 
https://www.kaggle.com/datasets/nathansmallcalder/lol-match-history-and-summoner-data-80k-matches

- The data comes from League of legends (European Region). 
- Shows team analysis and per player analysis providing insight stats in KDA, items, characters "champions', winning, etc 
- The data comes from Kaggle.com

##Introduction 
The data downloaded provides comprehensive match and player information from League of Legends, one of the worldâ€™s most popular multi-player online battle arena (MOBA) games. It features data from 35,000 matches and over 78,000 player records, covering various in-game aspects such as champion choices, performance metrics, match results, and other gameplay statistics. This dataset consist of 7 tables: MatchStatsTbl, TeamMatchStatsTbl, MatchTbl, RankTble, ChampionTbl, ItemTbl, SummonerTbl, and SummonerMatchTbl. 

A few key details to understand the following information provided. 

-**Champs or Champions** : The characters that players play within the game.
-**Queue Type**: Map selection or game style. ( 5v5, 2v2 1v1)
-**Lane**: Players dictate which lane they would like to play in certain maps such as classic.
-**Rank**: Level of player, Higher rank better player. 
- **Minions**: little soldiers, each team gets little soldiers. 
- **K/D/A**: Kills, Death, Assists

### Functions used
-Dplyr 
-ggplot
-plotly
-Kable Extra
-Grid Extra
-Joined functions

## Combined (Joined) Data

What we did is join most of our data sets to have a more efficient data structure. The following data sets were created:
 
 
```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  eval = FALSE   
)

library(tidyverse)
library(tidyr)
library(dplyr)
library(ggplot2)
library(kableExtra)
library(gridExtra)
library(plotly)
library(shiny)
library(here)
library(knitr)
source("R_Data_Prep.R")

```

**ChampionTbl** is the original dataset. 
```{r, echo=FALSE}
championTbl %>%
  slice_head(n = 20) %>%           
  kbl() %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "400px")
```

**match_rank_tbl**: This table displays every match in EU region with the following information: Queue type, Rank, Game duration. 
```{r, echo=FALSE}
match_rank_tbl %>%
  slice_head(n = 20) %>%
  kbl() %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "400px")
```


**TMR_Tble**: This table is a combined data of one original csv file and a combined data set. TeamMatchTbl and match_rank_tbl
```{r, echo = F}
TMR_Tble %>%
  slice_head(n = 20) %>%
  kbl() %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "400px")
```


**SMR_Tbl**: This table displays the players key detailed match stats.
```{r, echo=FALSE}
SMR_Tbl %>%
  slice_head(n = 20) %>%
  kbl() %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "400px")
```


**Team_Winner_Tbl**: This table only shows teams that have won from TMR_Tble.
```{r, echo=FALSE}
 Team_Winner_Tbl %>%
  slice_head(n = 20) %>%
  kbl() %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "400px")
```


**MSI_Tbl**: This table set will display the players detailed match stats which include kills for both enemy champions and monsters affiliated and include item purchase and summoner spells.
```{r, echo = F} 
MSI_Tbl%>%
  # should i group by queue type?
  mutate(Teams = ifelse(Win==0 , "Lose", "Win"), 
         Teams = factor(Teams, levels = c("Win", "Lose")))%>%
  drop_na(Teams)%>% 
  ggplot(aes(x=Teams, fill=Teams)) + 
  geom_bar() +
  labs(title = "Win vs. Lose", 
       x = "Teams", 
       y = "Number of Games")
```


```{r, echo=FALSE}
MSI_Tbl %>% 
   group_by(SummonerMatchFk) %>% 
  filter(n()>1) %>%   
  distinct(SummonerMatchFk, Lane, .keep_all = TRUE) %>% 
  arrange(SummonerMatchFk) %>%   
  filter(n()>1) %>% 
  group_by(SummonerMatchFk) %>% 
  mutate(tally_person = row_number()) %>% 
  filter(tally_person == 2) -> table2

MSI_Tbl %>% 
   group_by(SummonerMatchFk) %>% 
  filter(n()>1) %>%   
  distinct(SummonerMatchFk, Lane, .keep_all = TRUE) %>% 
  arrange(SummonerMatchFk) %>%   
  filter(n()>1) %>% 
  group_by(SummonerMatchFk) %>% 
  mutate(tally_person = row_number()) %>% 
  filter(tally_person == 1) %>%  
  select(SummonerMatchFk, SecondLane = Lane) -> table1

MSI_Tbl_doubles <- full_join(table1, table2, join_by(SummonerMatchFk))
rm(table1)
rm(table2)


MSI_Tbl <- MSI_Tbl %>% 
  group_by(SummonerMatchFk) %>% 
  anti_join(MSI_Tbl_doubles, join_by(SummonerMatchFk)) %>%
  mutate(SecondLane = NA) %>% 
  rbind(MSI_Tbl_doubles) %>% 
  distinct(SummonerMatchFk, .keep_all = TRUE) %>%
  select(-tally_person, -item1, -item2,-item3, -item4, -item5,-item6) %>% 
  arrange(SummonerMatchFk) 

rm(MSI_Tbl_doubles)

```

```{r, echo=FALSE, eval=TRUE}
 MSI_Tbl %>%
  slice_head(n = 20) %>%
  kbl() %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "400px")
```



## Lets Look at Team Stats!

Why is this interesting? 

Well in league of legends, **all sorts of kills are important.**

-**Gold is the biggest objective**, and it is mainly gained through all sorts of minion kills and enemy champion kills, this allows for solo lane or paired players to buy items that are necessary to get stronger. 

-**Baron kills** gives your whole team a chunk of gold and advanced stats for a period of time, leading to a higher chance of winning, **dragons** on the other hand do not provide gold but do enhance stats.

-**Tower Kills** are important because you get gold and you get an advantage around the map, providing map pressure by allowing your minions to move up without restriction.  

**Fun fact** there are several types of dragons: Infernal, Ocean, Mountain, Chemtec, Hextech, Cloud and Elder dragon.

```{r, echo=FALSE}
#Team win statistics : mean, min, max for Kills, Baron, Rift Herald, Dragon, Towers

Team_Winner_Stats <-Team_Winner_Tbl %>%
  filter(Side %in% c("Red","Blue")) %>%
  filter(QueueType %in% c("CLASSIC", "ARAM","SWIFTPLAY","ULTBOOK")) %>% 
  group_by(Side, QueueType) %>% 
  summarise(MeanKills = mean(Kills, na.rm = TRUE),
            MinKills = min(Kills, na.rm = TRUE),
            MaxKills = max(Kills, na.rm = TRUE),
            MeanBaron = mean(BaronKills, na.rm = TRUE),
            MinBaron = min(BaronKills, na.rm = TRUE),
            MaxBaron = max(BaronKills, na.rm = TRUE),
            MeanRiftHeraldKills = mean(RiftHeraldKills, na.rm = TRUE),
            MinRiftHeraldKills = min(RiftHeraldKills, na.rm = TRUE),
            MaxRiftHeraldKills = max(RiftHeraldKills, na.rm = TRUE),
            MeanDragonKills = mean(DragonKills, na.rm = TRUE),
            MinDragonKills = min(DragonKills, na.rm = TRUE),
            MaxDragonKills = max(DragonKills, na.rm = TRUE),
            MeanTowerKills = mean(TowerKills, na.rm = TRUE),
            MinTowerKills = min(TowerKills, na.rm = TRUE),
            MaxTowerKills = max(TowerKills, na.rm = TRUE)) 


Team_Winner_Stats %>% 
  rename('Queue Type' = QueueType) %>% 
  rename('Mean Kills' = MeanKills) %>% 
  rename('Min Kills' = MinKills) %>% 
  rename('Max Kills'= MaxKills) %>% 
  rename('Mean Baron' = MeanBaron) %>% 
  rename('Min Baron' = MinBaron) %>% 
  rename('Max Baron' = MaxBaron) %>% 
  rename('Mean Rift Herald Kills' = MeanRiftHeraldKills) %>% 
  rename('Min Rift Herald Kills' = MinRiftHeraldKills) %>% 
  rename('Max Rift Herald Kills' = MaxRiftHeraldKills) %>% 
  rename('Mean Dragon Kills' = MeanDragonKills) %>% 
  rename('Min Dragon Kills' = MinDragonKills) %>% 
  rename('Max Dragon Kills' = MaxDragonKills) %>% 
  rename('Mean Tower Kills' = MeanTowerKills) %>% 
  rename('Min Tower Kills' =MinTowerKills) %>% 
  rename('Max Tower Kills' =MaxTowerKills) %>% 
  kbl() %>%
  kable_styling() %>%
  scroll_box(width = "175%", height = "400px")


```

```{r, echo=FALSE}
common_theme <- theme_minimal(base_size = 14) +
  theme(
    axis.title.y = element_text(size = 12, face = "bold"),
    axis.title.x = element_text(size = 12, face = "bold"),
    axis.text = element_text(size = 10)
  )

```

### Mean of Kills, Baron Kills, Rift Herald Kills, Dragon Kills, Tower Kills 

Why is it that the mean for Baron, Rift and Dragon Kills is smaller than regular kills?

Dragons spawn every 5 to 7 minutes throughout the game. 

Rift Herald first spawn is at 15 minutes. 

Baron's first spawn is at 25 min, if baron is defeated, the boost last about 3 mins. Then afterwards the baron will spawn every 5 to 6 minutes. 

Game duration plays a big part in Summoners Rift Map (CLASSIC) and other maps as well such as ARAM. 

**Fun fact:** The first Baron must be defeated with at least 3-4 players, or else you will die. Afterwards 2 players is enough but it takes time to defeat Baron, not an easy tasks to do alone. 

```{r, echo=FALSE}
a1 <- ggplot(Team_Winner_Stats, aes(x = QueueType, y = MeanKills, fill = Side)) + geom_col(width = 1) + ggtitle("Average Kills") + coord_flip() + common_theme + labs(x = NULL, y = NULL) + guides(fill = "none")

a2 <- ggplot(Team_Winner_Stats %>% 
               filter(QueueType != "ARAM"), aes(x = QueueType, y = MeanBaron, fill = Side)) + geom_col(width = 1) + ggtitle("Average Baron Kills") + coord_flip() + common_theme + labs(x = NULL, y = NULL) + guides(fill = "none")

a3 <- ggplot(Team_Winner_Stats %>% 
               filter(QueueType != "ARAM") %>% 
               filter(MeanRiftHeraldKills != 0), aes(x = QueueType, y = MeanRiftHeraldKills, fill = Side)) + geom_col(width = 1) + ggtitle("Average Rift Herald Kills") + coord_flip() + common_theme + labs(x = NULL, y = NULL) + guides(fill = "none")

a4 <- ggplot(Team_Winner_Stats %>% 
               filter(QueueType != "ARAM"), aes(x = QueueType, y = MeanDragonKills, fill = Side)) + geom_col(width = 1) + ggtitle("Average Dragon Kills") + coord_flip() + common_theme + labs(x = NULL, y = NULL) + guides(fill = "none")
 
a5 <- ggplot(Team_Winner_Stats, aes(x = QueueType, y = MeanTowerKills, fill = Side)) + geom_col(width = 1) + ggtitle("Average Tower Kills") + coord_flip() + common_theme + labs(y = NULL, x = NULL) 

```


```{r, echo= FALSE}
grid.arrange(a1,a3,a4,a5,a2, nrow = 3, ncol = 2, top = "Team Winner Statistics", left = "Queue Type", bottom = "Average Count")
```


Looking at Dragons vs Baron vs Rift Herald, we can see that Dragons are killed more frequently. Spawning is a factor, also you do not need many members to kill a dragon, unless it is the elder dragon. 

**We can see that Aram and Classic both hold high mean kills, why is that?**

###Max of Kills, Baron Kills, Rift Herald Kills, Dragon Kills, Tower Kills 

Max kills vary through map, as you can see not that many kills in swiftplay, some maps have shorter and more difficult objectives during game, making it more difficult to kill. 

We did not include ARAM for Baron, Dragon and Rift Herald kills. 
- This is simple is because they do not have those monsters in that type of QUEUETYPE
- Also you might see CHERRY missing, this is also important to point out, they are an arena type of map. Their teams consist of 2 players instead of the typical 5.


```{r, echo=FALSE}
b1 <- ggplot(Team_Winner_Stats, aes(x = QueueType, y = MaxKills, fill = Side)) + geom_col(width = 1) + ggtitle("Max Kills") + coord_flip() + common_theme + labs(x = NULL, y = NULL)  + guides(fill = "none")

b2 <- ggplot(Team_Winner_Stats %>% 
               filter(QueueType != "ARAM"), aes(x = QueueType, y = MaxBaron, fill = Side)) + geom_col(width = 1) + ggtitle("Max Baron Kills") + coord_flip() + common_theme + labs(x = NULL, y = NULL) + guides(fill = "none")

b3 <- ggplot(Team_Winner_Stats %>% 
               filter(QueueType != "ARAM") %>% 
               filter(MeanRiftHeraldKills != 0), aes(x = QueueType, y = MaxRiftHeraldKills, fill = Side)) + geom_col(width = 1) + ggtitle("Max Rift Herald Kills") + coord_flip() + common_theme + labs(x = NULL, y = NULL) + guides(fill = "none")

b4 <- ggplot(Team_Winner_Stats %>% 
               filter(QueueType != "ARAM"), aes(x = QueueType, y = MaxDragonKills, fill = Side)) + geom_col(width = 1) + ggtitle("Max Dragon Kills") + coord_flip() + common_theme + labs(x = NULL, y = NULL) + guides(fill = "none")
 
b5 <- ggplot(Team_Winner_Stats, aes(x = QueueType, y = MaxTowerKills, fill = Side)) + geom_col(width = 1) + ggtitle("Max Tower Kills") + coord_flip() + common_theme + labs(y = NULL, x = NULL) 

```


```{r, echo=FALSE}
grid.arrange(b1,b3,b4,b5,b2, nrow = 3, ncol = 2, top = "Team Winner Statistics", left = "Queue Type", bottom = "Max Count")

```


---

### Team Game Duration 

Lets go ahead and evaluate the Blue teams and Red teams 

Blue Team
- 
-
-

```{r, echo=FALSE}
ggplot(TMR_Tble %>% 
         mutate(BlueWin = ifelse(BlueWin == 0,"Lose","Win")) %>% 
         drop_na(QueueType) %>% 
         drop_na(BlueWin), aes(x= GameDuration, y = BlueKills, color = BlueWin )) + geom_jitter(alpha = 0.4) + facet_wrap(~QueueType)

```


Red Team
-
-
-

```{r, echo=FALSE}

ggplot(TMR_Tble %>% 
         mutate(RedWin = ifelse(RedWin == 0,"Lose","Win")) %>% 
         drop_na(QueueType) %>% 
         drop_na(RedWin), aes(x= GameDuration, y = RedKills, color = RedWin )) + geom_jitter(alpha = 0.4) + facet_wrap(~QueueType)

```



What do we see? 

```{r, echo=FALSE}

TMR_Tble %>% 
  mutate(TotalKills = rowSums(across(c(RedKills, BlueKills)), na.rm = TRUE)) %>% 
  count(Winning_Team, wt = TotalKills) 

```

```{r, echo=FALSE}

ggplot(TMR_Tble %>% 
         mutate(TotalKills = rowSums(across(c(RedKills, BlueKills)), na.rm = TRUE)), aes(x = GameDuration, y = TotalKills)) + geom_jitter(alpha = 0.2)

```



## Winning Teams

The kills on each winning side 

```{r}
Team_Winner_Tbl %>% 
  count(Side, wt = Kills)
```

```{r, echo=FALSE}
ggplot(Team_Winner_Tbl, aes(x = GameDuration, color = Side)) + geom_density() 

```

```{r,echo=FALSE}

ggplot(Team_Winner_Tbl, aes(x = GameDuration, color = RankName)) + geom_density() + facet_wrap(~RankName)

```


```{r, echo=FALSE}
ggplot(Team_Winner_Tbl, aes(x = GameDuration, y = Kills, color = Side)) + geom_jitter( alpha= 0.5)

```


```{r, echo=FALSE}
ggplotly(ggplot(Team_Winner_Tbl, aes(x = GameDuration, y = Kills, color = QueueType)) + geom_point(alpha = 0.2))

```













```{r, echo = F}

MSI_Tbl%>%
  ungroup() %>% 
  summarise('Avg Gold Total'= mean(TotalGold, na.rm = T),
            'Median Total Gold' = median(TotalGold, na.rm = T), 
            'Min Total Gold' = min(TotalGold, na.rm = T),
            'Max Total Gold' = max(TotalGold, na.rm = T),
            'Avg Minions Killed' = mean(MinionsKilled, na.rm = T),
            'Median Minions Killed' = median(MinionsKilled, na.rm = T),
            'Min Minions Killed' = min(MinionsKilled, na.rm = T),
            'Max Minions Killed' = max(MinionsKilled, na.rm = T),
            'Avg Damage Dealt' = mean(DmgDealt, na.rm = T),
            'Median Damage Dealt' = median(DmgDealt, na.rm = T), 
            'Min Damage Dealt' = min(DmgDealt, na.rm = T),
            'Max Damage Dealt' = max(DmgDealt, na.rm = T),
            'Avg Damage Taken' = mean(DmgTaken, na.rm = T),
            'Median Damage Taken' = median(DmgTaken, na.rm = T), 
            'Min Damage Taken' = min(DmgTaken, na.rm = T),
            'Max Damage Taken' = max(DmgTaken, na.rm = T),
            'Avg Turret Damage Dealt' = mean(TurretDmgDealt, na.rm = T),
            'Median Turret Damage Dealt' = median(TurretDmgDealt, na.rm = T),
            'Min Turret Damage Dealt' = min(TurretDmgDealt, na.rm = T), 
            'Max Turret Damage Dealt' = max(TurretDmgDealt, na.rm = T)) %>%
  kbl() %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "170px")

```

```{r, echo=FALSE}
MSI_Tbl %>%
  group_by(SummonerMatchFk)%>%
  summarise(num_lanes = n_distinct(Lane))%>% #count the unique lanes
  filter(num_lanes > 1)%>%
  summarise(total_players = n()) 
```

Mean median min and max of minions killed: 
```{r}
m <- MSI_Tbl%>%
  drop_na(MinionsKilled) %>%
  group_by(Lane) %>% 
  summarise(avg_minionsKilled = mean(MinionsKilled, na.rm = T),
            median_minionsKilled = median(MinionsKilled, na.rm = T),
            min_minionsKilled = min(MinionsKilled, na.rm = T),
            max_minionsKilled = max(MinionsKilled, na.rm = T))

mean1 <- ggplot(m, aes(x = avg_minionsKilled, y = Lane, fill = Lane)) + geom_col() + labs(title = "Average Minions Killed Per Lane", x = "Average Minions Killed", y = "Lane")
mean1

med1 <- ggplot(m, aes(x = median_minionsKilled, y = Lane, fill = Lane)) + geom_col() + labs(title = "Median Minions Killed Per Lane", x = "Median Minions Killed", y = "Lane")
med1

max1 <- ggplot(m, aes(x = max_minionsKilled, y = Lane, fill = Lane)) + geom_col() + labs(title = "Max Minions Killed Per Lane", x = "Maximum Minions Killed", y = "Lane")
max1
```



Mean median min and max of Turret Damage killed:
```{r,  echo = F}
m <- MSI_Tbl%>%
  drop_na(TurretDmgDealt) %>% 
  group_by(Lane) %>% 
  summarise(avg_TurretDmgDealt = mean(TurretDmgDealt, na.rm = T),
            median_TurretDmgDealt = median(TurretDmgDealt, na.rm = T),
            min_TurretDmgDealt = min(TurretDmgDealt, na.rm = T), 
            max_TurretDmgDealt = max(TurretDmgDealt, na.rm = T))

mean2 <-ggplot(m, aes(x = avg_TurretDmgDealt, y = Lane, fill = Lane)) + geom_col() + labs(title = "Average Damage Turret Dealt Per Lane", x = "Average Damage Turret Dealt", y = "Lane")
mean2

med2 <- ggplot(m, aes(x = median_TurretDmgDealt, y = Lane, fill = Lane)) + geom_col() + labs(title= "Median Damage Turret Dealt Per Lane", x = "Median Damage Turret Dealt", y = "Lane")
med2

max2 <- ggplot(m, aes(x = max_TurretDmgDealt, y = Lane, fill = Lane)) + geom_col() + labs(title = "Maximum of Damage Turret Dealt", x ="Maximum of Damage Turret Dealt", y = "Lane")
max2
```



mean, median, min, and max of Damage Taken:
```{r, echo = F}
 m <- MSI_Tbl%>%
  drop_na(DmgTaken) %>% 
  group_by(Lane) %>% 
  summarise(avg_DmgTaken = mean(DmgTaken, na.rm = T),
            median_DmgTaken = median(DmgTaken, na.rm = T), 
            min_DmgTaken = min(DmgTaken, na.rm = T),
            max_DmgTaken = max(DmgTaken, na.rm = T))

mean3 <- ggplot(m, aes(x = avg_DmgTaken, y = Lane, fill = Lane)) + geom_col() + labs(title = "Average Damage Taken Per Lane", x = "Average Damage Taken", y = "Lane")
mean3  

med3 <- ggplot(m, aes(x = median_DmgTaken, y = Lane, fill = Lane)) + geom_col() + labs(title = "Median Damage Taken Per Lane", x = "Median Damage Taken", y = "Lane")
med3

max3 <- ggplot(m, aes(x = max_DmgTaken, y = Lane, fill = Lane)) + geom_col() + labs(title = "Maximum Damage Taken Per Lane", x = "Maximum Damage Taken", y = "Lane")
max3
```


mean, median, min, and max of Damage Dealt:
```{r, echo = F}

 m<-MSI_Tbl%>%
  drop_na(DmgDealt) %>% 
  group_by(Lane) %>% 
  summarise(avg_DmgDealt = mean(DmgDealt, na.rm = T),
            median_DmgDealt = median(DmgDealt, na.rm = T), 
            min_DmgDealt = min(DmgDealt, na.rm = T),
            max_DmgDealt = max(DmgDealt, na.rm = T))

mean4 <-ggplot(m, aes(x = avg_DmgDealt, y = Lane, fill = Lane)) + geom_col() + labs(title = "Average Damage Dealt Per Lane", x = "Average Damage Dealt", y = "Lane") 
mean4

med4 <- ggplot(m, aes(x = median_DmgDealt, y = Lane, fill = Lane)) + geom_col() + labs(title = "Median Damage Dealt Per Lane", x = "Median Damage Dealt", y = "Lane")
med4

max4 <- ggplot(m, aes(x = max_DmgDealt, y = Lane, fill = Lane)) + geom_col() + labs(title = "Maximum Damage Dealt Per Lane", x = "Maximum Damage Dealt", y = "Lane")
max4
```


mean, median, min, and max of Total Gold:
```{r, echo = F}
 m<-MSI_Tbl%>%
  drop_na(TotalGold) %>% 
  group_by(Lane) %>% 
  summarise(avg_TotalGold = mean(TotalGold, na.rm = T),
            median_TotalGold = median(TotalGold, na.rm = T), 
            min_TotalGold = min(TotalGold, na.rm = T),
            max_TotalGold = max(TotalGold, na.rm = T))

mean5 <-ggplot(m, aes(x = avg_TotalGold, y = Lane, fill = Lane)) + geom_col() + labs(title = "Average Total Gold Per Lane", x = "Average Total Gold", y = "Lane")
mean5

med5 <- ggplot(m, aes(x = median_TotalGold, y = Lane, fill = Lane)) + geom_col() + labs(title = "Median Total Gold Per Lane", x = "Median Total Gold", y = "Lane")
med5

max5 <- ggplot(m, aes(x = max_TotalGold, y = Lane, fill = Lane)) + geom_col() + labs(title = "Maximum Total Gold Per Lane", x = "Maximum Total Gold", y = "Lane")
max5
```

Combining multiple plots for the averages, medians, and maximums of minions killed, Turret Damage killed, Damage Taken, Damage Dealt, and Total Gold
```{r, echo=False}
grid.arrange(mean1, mean2, mean3, mean4, mean5, nrow=5) + theme(axis.text = element_text(angle = 45, hjust = 0))
grid.arrange(med1, med2, med3, med4, med5, nrow=5)
grid.arrange(max1, max2, max3, max4, max5, nrow=5)
```



4. MSI_tbl
filter NAs from item names, 
combine and count total items, 
most popular items, 
least popular items,
Median and mean items a player holds. 

```{r, echo=FALSE}
#Removing NAs from the MSI_Tbl
temp_MSI <- MSI_Tbl%>%
  drop_na(ItemName, ItemName_2, ItemName_3, ItemName_4, ItemName_5, ItemName_6)

#Combining the item name columns into one single column
temp_MSI_Tbl <- MSI_Tbl%>%
  pivot_longer(
    cols = starts_with("ItemName"), # automatically combines columns
    names_to = "Items",             # new column that stores old columns 
    values_to = "ItemNames"         # new column that has the combined columns
     )

#Count the total number of items
new_temp_MSI_Tbl <- temp_MSI_Tbl %>%
  drop_na(new_temp_MSI_Tbl) %>% 
  group_by(ItemNames) %>% 
  summarise(Total_Items=n())

#Find most popular items
new_temp_MSI_Tbl%>% 
  slice_max(Total_Items, n=10)

#least popular item
new_temp_MSI_Tbl %>% 
  slice_min(Total_Items)

#join temp_MSI_Tbl and new_temp_MSI_Tbl to get the mean and median of items a player holds.
N_MSI_Tbl <- full_join(temp_MSI_Tbl, new_temp_MSI_Tbl, by = join_by(ItemNames)) 


#Mean and median of items a player holds
new_temp_MSI_Tbl %>% 
  drop_na(ItemNames) %>% 
  group_by(ItemNames) %>% 
  summarise(Items_used_avg = mean(Total_Items), 
            Items_used_median = median(Total_Items))


```


5. Plot game duration as the Y value and Queue type as the X value, filter based on RankName.
```{r, echo=FALSE}
match_rank_tbl %>%
  group_by(RankName)%>%
  summarise(Duration= n())

ggplot(match_rank_tbl, aes(x = GameDuration, color= QueueType)) + 
  geom_density() + 
  labs(title = "Game Duration", x = "Game Duration", y = "Density") 
```


```{r, echo=FALSE}
ggplot(matchStatsTbl, aes(x= kills, color = Lane)) + geom_density() + facet_wrap(~Lane)
```



6. Analyze if totalgold or dmgdealt increases the chances of winning

The plot shows that earning more gold and dealing more damage do increase the chances of winning
```{r, echo=False}
ggplot(MSI_Tbl %>% drop_na(TotalGold), aes(x = TotalGold, y = DmgDealt, color = Win)) + geom_point(alpha = 0.3) + 
  labs(title="Win: Total Gold vs Damage Dealt",
       x = "Total Gold",
       y = "Damage Dealt")
  
```

7. Plot top 10 popular items 

```{r, echo=FALSE}
Top_Items <- new_temp_MSI_Tbl%>%
  drop_na(ItemNames) %>%
  slice_max(Total_Items, n = 10)

ggplotly(ggplot(Top_Items, aes(x=reorder(ItemNames, -Total_Items), y = Total_Items, fill = ItemNames, text = paste("Count:", after_stat(y)))) + geom_col() + 
           labs(
             title ="Top 10 Items",
             x = "Item Names",
             y = "Total Items"), tooltip = "text") + theme(axis.text.y = element_text(angle = 45, vjust = 0))

``` 


```{r, echo=FALSE}
#Remove temporary MSI tables not needed
rm(temp_MSI)
rm(Top_Items)
rm(new_temp_MSI_Tbl)
rm(N_MSI_Tbl)
rm(temp_MSI_Tbl)
```


8. Plot top 10 champions
```{r,echo=FALSE}
champs <- SMR_Tbl %>%
  group_by(ChampionName) %>% 
  summarise(num_champs = n())
```

```{r, echo=FALSE}

  summarise(num_champs = n()) %>% 
  drop_na(ChampionName)

```

The plot shows the top 10 champions from left to right
```{r,echo = FALSE}
Top_champs <- champs %>% 
  slice_max(num_champs, n = 10)

ggplotly(ggplot(Top_champs, aes(x = reorder(ChampionName, -num_champs), y = num_champs, fill = ChampionName, text = paste("Count:", after_stat(y)))) + geom_col() + 
           labs(title = "Top 10 Champions", 
                x = "Champions Name",
                y = "Number of Champions"), tooltip = "text")
```

```{r, echo=FALSE}
#Remove extra tables not needed 
rm(Top_champs)
rm(champs)
```

```{r, echo=FALSE}
#Second Lane Data analysis for MSI Kills Column plot
ggplotly(
  ggplot( 
    MSI_Tbl %>% 
    select(SecondLane,kills,SummonerMatchFk) %>% 
    drop_na(SecondLane) %>% 
    group_by(SecondLane) %>%
    count(SecondLane, wt = kills) %>% 
    rename(kills = n), 
  aes(x = SecondLane, y = kills, fill = SecondLane, text = paste("Count:", after_stat(y)))
  ) + geom_col(), 
  tooltip = "text", 
  na.rm = TRUE 
  )

```
  

```{r, echo=FALSE}
#Lane Data analysis for MSI Kills Column plot
ggplotly(
  ggplot( MSI_Tbl %>% 
  select(Lane,kills,SummonerMatchFk) %>% 
  drop_na(Lane) %>% 
  group_by(Lane) %>%
  count(Lane, wt = kills) %>% 
  rename(kills = n), 
  aes(x = Lane, y = kills, fill = Lane, text = paste("Count:", after_stat(y))))
  + geom_col() + labs(title= "Kills vs Lane"), 
  tooltip = "text", 
  na.rm = TRUE )

```


10. Find mean, min, max of visionscore and plot mean of visionScore for winning and loosing teams


```{r,echo=FALSE}
VS <-MSI_Tbl %>% 
  mutate(Win = ifelse(Win==0, "Lose", "Win")) %>% 
  group_by(Win) %>% 
  summarise(VS_avg = mean(visionScore, na.rm =T),
            VS_min = min(visionScore, na.rm =T), 
            VS_max = max(visionScore, na.rm =T)) %>%
  drop_na(Win)

```

The plot shows higher vision score average will have higher chances of winning
```{r, echo=FALSE}
ggplot(VS, aes(x = Win, y = VS_avg, fill = Win)) +
  geom_col() + 
  labs(
   title = "Vision Score: Winning vs Losing",
       x = "win/lose",
       y = "Vision Score Average"
    )

```

```{r, echo=FALSE}
#Remove temp table VS
rm(VS)
```

11. Analyze if higher visionScore mean more wins
```{r, echo=FALSE}
ggplot(MSI_Tbl %>% 
         mutate(Win = ifelse(Win == 0, "Lose","Win")), aes(x = visionScore, color = Win)) + geom_density(alpha = 0.4) + 
         labs(title = "Vision Score: Winning vs Losing Teams",
       x= "Vision Score", y = "Density")
```

11. Analyze if higher visionScore will have more wins
```{r, echo=FALSE}
ggplot(MSI_Tbl %>% drop_na(visionScore), aes(x = visionScore, color = factor(Win))) + geom_density(alpha = 0.4) + 
  labs(title = "Vision Score: Winning vs Losing Teams",
       x= "Vision Score", y = "Density")
```



12. Compare kills and Lane 
```{r, echo=FALSE}
ggplotly(ggplot(MSI_Tbl %>% 
                  group_by(Lane) %>% 
                  count(Lane, wt = kills) %>% 
                  rename(kills = n), aes(x = Lane, y = kills, fill = Lane, text = paste("Count:", after_stat(y)))) + geom_col() + labs(title = "Kills vs Lane", x = "Lane", y = "kills"), tooltip= "text") 
```


## Veronica

1. TMR_tbl create column (boolean) indicating who won. Lets combine TMR with Champion Table 













7.each player and the amount of games they play per queue type 

```{r, echo=FALSE}
Player_Games <- SMR_Tbl %>% 
  select(SummonerFk,QueueType,RankFk,RankName) %>% 
  group_by(QueueType, SummonerFk, RankName) %>%
  summarise(games = n()) %>% 
  arrange(SummonerFk)

```

How many players play in each queue type, a player can play multiple queue types in league of legends. No map restriction.
```{r, echo=FALSE}

ggplotly(ggplot(Player_Games %>% 
                  drop_na(QueueType),aes(x = QueueType, fill = QueueType, text = paste("Count:", after_stat(count)))) + geom_bar(), tooltip = "text", na.rm = TRUE)

```

```{r, echo=FALSE}
Player_Games %>%
  group_by(RankName) %>% 
  distinct(SummonerFk,.keep_all = TRUE) %>% 
  summarise(n=n()) %>% 
  drop_na(RankName) %>% 
  rename(Players = n)
```

What rank players fall in in this data set. 

```{r, echo=FALSE}
ggplotly(ggplot(Player_Games %>%
  group_by(RankName) %>% 
  distinct(SummonerFk,.keep_all = TRUE) %>% 
  summarise(n=n()) %>% 
  drop_na(RankName) %>% 
  rename(Players = n),aes(x = RankName, y = Players, fill = RankName, text = paste("Count:", after_stat(y)))) + geom_col(), tooltip = "text", na.rm = TRUE)

```

Fun fact: 
```{r}
#letsgo 
```

